#!/usr/bin/env sh
set -e

echo "üîç Running pre-commit hook..."

# Source nvm if it exists (common on Windows)
if [ -f "$HOME/.nvm/nvm.sh" ]; then
    . "$HOME/.nvm/nvm.sh"
fi

# Add common Windows Node.js paths
export PATH="$PATH:/c/Program Files/nodejs:/c/Program Files (x86)/nodejs"
export PATH="$PATH:$APPDATA/npm:$HOME/AppData/Roaming/npm"

# Try multiple methods to run lint-staged
if command -v npx >/dev/null 2>&1; then
    echo "‚úì Using npx"
    npx lint-staged --config ./config/lint-staged.config.json
elif command -v npm >/dev/null 2>&1; then
    echo "‚úì Using npm"
    npm exec lint-staged -- --config ./config/lint-staged.config.json
elif [ -x "/c/Program Files/nodejs/npx.cmd" ]; then
    echo "‚úì Using npx.cmd"
    "/c/Program Files/nodejs/npx.cmd" lint-staged --config ./config/lint-staged.config.json
else
    echo "‚ùå ERROR: Cannot find npm/npx"
    echo "   PATH: $PATH"
    exit 1
fi

echo "‚úÖ Pre-commit checks passed!"