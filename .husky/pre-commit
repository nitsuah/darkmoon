#!/usr/bin/env sh
# Disable exit on error temporarily to test npm availability
echo "üîç Running pre-commit hook..."

# Try using npx directly (comes with npm)
if command -v npx >/dev/null 2>&1; then
    echo "‚úì Using npx from PATH"
    npx lint-staged --config ./config/lint-staged.config.json
    exit $?
fi

# Try npm from PATH
if command -v npm >/dev/null 2>&1; then
    echo "‚úì Using npm from PATH"
    npm exec lint-staged -- --config ./config/lint-staged.config.json
    exit $?
fi

# Windows: Try npm.cmd in Program Files
if [ -x "/c/Program Files/nodejs/npm.cmd" ]; then
    echo "‚úì Using npm.cmd from Program Files"
    "/c/Program Files/nodejs/npm.cmd" exec lint-staged -- --config ./config/lint-staged.config.json
    exit $?
fi

# Windows: Try direct path to npx
if [ -x "/c/Program Files/nodejs/npx.cmd" ]; then
    echo "‚úì Using npx.cmd from Program Files"
    "/c/Program Files/nodejs/npx.cmd" lint-staged --config ./config/lint-staged.config.json
    exit $?
fi

# Last resort: skip hook with warning
echo "‚ö†Ô∏è  WARNING: Could not find npm/npx. Skipping pre-commit checks."
echo "   Please ensure Node.js is installed and in your PATH."
echo "   You can run 'npm run precommit' manually to lint your changes."
exit 0